webpackJsonp([29],{"9waO":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("ZLEe"),n=a.n(i),l=a("rVsN"),s=a.n(l),o=a("vLgD");var r={getList:function(e){return Object(o.a)({url:"/send/details",method:"get",params:e})},add:function(e){return Object(o.a)({url:"/send/details",method:"post",data:e})},get:function(e){return Object(o.a)({url:"/send/details/"+e,method:"get"})},patch:function(e){return Object(o.a)({url:"/send/details/"+e.id,method:"put",data:e})}},d=a("nTQZ"),c=a("4T3X"),m=a("YgaF"),u=a("Q0Ca"),f=a("Mukr"),p=a("4spO"),v={dateSend:"发货日期",noLogistics:"物流单号",noBatch:"采购批次号",sn:"SN",sns:"SN",remark:"备注"},h={data:function(){return{addVisible:!1,addType:1,list:[],listLoading:!0,addLoading:!1,totalCount:0,uploadSNUrl:p.a.api+"/upload/sn",fileList:[],formInline:{pageNo:1,pageSize:10,dateSend:"",noLogistics:"",typeAsset:""},addForm:{id:"",idSend:"",sn:"",dateSend:"",noLogistics:"",sns:"",noBatch:"",remark:"",nameUpdater:"",timeUpdate:"",nameCreator:"",timeCreate:""},info:{},dicts:{typeAsset:{list:[],obj:{}}},purchList:{list:[],obj:{}},sendList:{list:[],obj:{}}}},filters:{},created:function(){this.getDict(),this.fetchData()},mounted:function(){},computed:{addTitle:function(){return 1===this.addType?"新增发货明细信息":2===this.addType?"修改发货明细信息":3===this.addType?"发货明细详细信息":void 0},btnName:function(){return 2===this.addType?"修改":"新增"}},methods:{snUploadSuccess:function(e){1===e.code&&(this.addForm.sns=this.snParse(e.result))},snParse:function(e){var t="";return e.forEach(function(a,i){t+=a.sn,i!==e.length-1&&(t+="\n")}),t},snUploadError:function(e){console.log(e)},handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){console.log(e)},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},download:function(e){1===e&&Object(f.a)("/download/template/sn","sn")},upload:function(){},sendChange:function(e){e?this.getSend(Object(u.parseTime)(e)):(this.sendList={list:[],obj:{}},this.purchList={list:[],obj:{}},this.addForm.noLogistics="",this.addForm.noBatch="")},noChange:function(e){this.getSend(Object(u.parseTime)(this.addForm.dateSend),e)},getCountInfo:function(e){return new s.a(function(t,a){d.a.get(e).then(function(e){t(e)}).then(function(e){t(e)})})},getSend:function(e,t){m.a.getSend(e,t).then(function(e){t?this.purchList=e:this.sendList=e}.bind(this))},getPurch:function(){m.a.getPurch().then(function(e){this.purchList=e}.bind(this))},getDict:function(){Object(c.a)("dict_14").then(function(e){this.dicts.typeAsset=e}.bind(this))},initSearch:function(){var e=this,t={};return n()(this.formInline).forEach(function(a){var i=e.formInline[a];void 0!==i&&null!==i&&""!==i&&(t[a]=i)}),t},searchList:function(){this.formInline.pageNo=1,this.fetchData()},fetchData:function(){var e=this,t=this.initSearch();this.listLoading=!0,r.getList(t).then(function(t){e.list=t.result.recordList,e.totalCount=t.result.totalRecord,e.listLoading=!1})},handleSizeChange:function(e){this.formInline.pageNo=1,this.formInline.pageSize=e,this.fetchData()},handleCurrentChange:function(e){this.formInline.pageNo=e,this.fetchData()},clickBtn:function(e,t,a){var i=this;this.addType=e,1===e?(i.addLoading=!1,n()(i.addForm).forEach(function(e){i.addForm[e]=""})):this.getInfo(t,a),this.addVisible=!0},getInfo:function(e,t){var a=this,i=this,l=1;this.addLoading=!0,r.get(e).then(function(e){var t;t=e.result,n()(i.addForm).forEach(function(e){i.addForm[e]=t[e]}),l++,2===a.addType&&(a.addLoading=!1),l>2&&(a.addLoading=!1)}),3===this.addType&&d.a.get(t).then(function(e){a.info=e.result,++l>2&&(a.addLoading=!1)})},validSwitch:function(e){return 1===this.addType&&"sn"===e||(2===this.addType&&"sns"===e||void 0)},valid:function(){for(var e in v)if(!this.validSwitch(e)){var t=this.addForm[e];if("remark"!==e){if(""===t.toString().trim()){var a=v[e]+"不能为空！";return this.$message.error(a),!1}if("sn"===e&&t.length>30){var i=v[e]+"长度不能超过30！";return this.$message.error(i),!1}}else if(t.length>200){var n=v[e]+"长度不能超过200！";return this.$message.error(n),!1}}return!0},validSn:function(){var e=this.addForm.sns.trim().replace(/\s+/g,"\n").split("\n");if(e.length>1e4){return this.$message.error("单次SN录入不能超过一万条!"),!1}for(var t=/^[0-9a-zA-Z]+$/,a=0;a<e.length;a++){var i=e[a];if(!t.test(i)){var n="第"+(a+1)+"条SN不合法,SN只能数字与字母！";return this.$message.error(n),!1}if(i.length>30){var l="第"+(a+1)+"条SN长度过长,SN长度不能超过30！";return this.$message.error(l),!1}}for(var s=0;s<e.length;s++){if(!r(e[s],s)){var o="第"+(s+1)+"条SN重复！";return this.$message.error(o),!1}}function r(t,a){for(var i=a+1;i<e.length;i++){if(t===e[i])return!1}return!0}return!0},addSubmit:function(){var e=this;if(this.valid()&&(1!==this.addType||this.validSn())){var t=this,a="";this.addLoading=!0,1===this.addType?(a="添加成功！",this.addForm.sns=this.addForm.sns.trim().replace(/\s+/g,"\n").replace(/\n/g,","),r.add(this.addForm).then(function(e){i()},function(t){e.addForm.sns=e.addForm.sns.split(",").join("\n"),n()})):2===this.addType&&(a="修改成功！",r.patch(this.addForm).then(function(e){i()},function(e){n()}))}function i(){t.$message({message:a,type:"success"}),t.addVisible=!1,t.addLoading=!1,t.fetchData()}function n(){t.addLoading=!1}},addCancel:function(){this.addVisible=!1}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container calendar-list-container"},[a("div",{staticClass:"filter-container"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline}},[a("el-form-item",{attrs:{label:"发货日期"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期"},model:{value:e.formInline.dateSend,callback:function(t){e.$set(e.formInline,"dateSend",t)},expression:"formInline.dateSend"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"物流单号"}},[a("el-input",{attrs:{clearable:""},model:{value:e.formInline.noLogistics,callback:function(t){e.$set(e.formInline,"noLogistics",t)},expression:"formInline.noLogistics"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"资产类型"}},[a("el-select",{attrs:{clearable:"",placeholder:"全部"},model:{value:e.formInline.typeAsset,callback:function(t){e.$set(e.formInline,"typeAsset",t)},expression:"formInline.typeAsset"}},e._l(e.dicts.typeAsset.list,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchList}},[e._v("查询")]),e._v(" "),e.btn.add?a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){e.clickBtn(1)}}},[e._v(e._s(e.btn.add))]):e._e(),e._v(" "),e.btn.down_board?a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-success"},on:{click:function(t){e.download(1)}}},[e._v(e._s(e.btn.down_board))]):e._e(),e._v(" "),e.btn.export?a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-success"},on:{click:function(t){e.download(2)}}},[e._v(e._s(e.btn.export))]):e._e()],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:e.listLoading,expression:"listLoading",modifiers:{body:!0}}],attrs:{data:e.list,"element-loading-text":"Loading",border:"",stripe:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"发货日期",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("parseTime")(t.row.dateSend,"{y}-{m}-{d}")))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"物流单号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.noLogistics))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"采购批次号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.noBatch))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"资产类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.typeAsset))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"型号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.versionTypeAsset))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"SN",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.sn))]}}])}),e._v(" "),a("el-table-column",{staticStyle:{"white-space":"nowrap"},attrs:{align:"center",label:"操作","class-name":"mid-padding fixed-width",width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.btn.edit?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.clickBtn(2,t.row.id)}}},[e._v(e._s(e.btn.edit))]):e._e(),e._v(" "),e.btn.info?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){e.clickBtn(3,t.row.id,t.row.idSend)}}},[e._v(e._s(e.btn.info))]):e._e()]}}])})],1),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","page-sizes":[5,10,20,30,40,50,60,70,80,90,100],"current-page":e.formInline.pageNo,total:e.totalCount,"page-size":e.formInline.pageSize},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:e.addTitle,visible:e.addVisible,width:"800px"},on:{"update:visible":function(t){e.addVisible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.addLoading,expression:"addLoading"}],ref:"form",attrs:{model:e.addForm,"label-width":"100px"}},[a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"发货日期",required:""}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期",disabled:1!==e.addType},on:{change:e.sendChange},model:{value:e.addForm.dateSend,callback:function(t){e.$set(e.addForm,"dateSend",t)},expression:"addForm.dateSend"}})],1)],1),e._v(" "),1!==e.addType?a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"SN",required:""}},[a("el-input",{attrs:{type:"text",disabled:3===e.addType},model:{value:e.addForm.sn,callback:function(t){e.$set(e.addForm,"sn",t)},expression:"addForm.sn"}})],1)],1):e._e()]),e._v(" "),a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"物流单号",required:""}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:1!==e.addType},on:{change:e.noChange},model:{value:e.addForm.noLogistics,callback:function(t){e.$set(e.addForm,"noLogistics",t)},expression:"addForm.noLogistics"}},e._l(e.sendList.list,function(e){return a("el-option",{key:e.id,attrs:{label:e.noLogistics,value:e.noLogistics}})}))],1)],1),e._v(" "),a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"采购批次号",required:""}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:1!==e.addType},model:{value:e.addForm.noBatch,callback:function(t){e.$set(e.addForm,"noBatch",t)},expression:"addForm.noBatch"}},e._l(e.purchList.list,function(e){return a("el-option",{key:e.id,attrs:{label:e.noBatch,value:e.noBatch}})}))],1)],1)]),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"采购日期"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期",disabled:""},model:{value:e.info.dateBuyer,callback:function(t){e.$set(e.info,"dateBuyer",t)},expression:"info.dateBuyer"}})],1)],1)]):e._e(),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"资产类型"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.typeAsset,callback:function(t){e.$set(e.info,"typeAsset",t)},expression:"info.typeAsset"}})],1)],1),e._v(" "),a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"型号"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.versionTypeAsset,callback:function(t){e.$set(e.info,"versionTypeAsset",t)},expression:"info.versionTypeAsset"}})],1)],1)]):e._e(),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"发货人"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.nameSender,callback:function(t){e.$set(e.info,"nameSender",t)},expression:"info.nameSender"}})],1)],1),e._v(" "),a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"电话"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.mobileSender,callback:function(t){e.$set(e.info,"mobileSender",t)},expression:"info.mobileSender"}})],1)],1)]):e._e(),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"司机"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.nameDriver,callback:function(t){e.$set(e.info,"nameDriver",t)},expression:"info.nameDriver"}})],1)],1),e._v(" "),a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"电话"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.mobileDriver,callback:function(t){e.$set(e.info,"mobileDriver",t)},expression:"info.mobileDriver"}})],1)],1)]):e._e(),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"车牌号"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.noCar,callback:function(t){e.$set(e.info,"noCar",t)},expression:"info.noCar"}})],1)],1)]):e._e(),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"矿场名称"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.nameMine,callback:function(t){e.$set(e.info,"nameMine",t)},expression:"info.nameMine"}})],1)],1)]):e._e(),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-24"},[a("el-form-item",{attrs:{label:"收货地址"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.addressReceiver,callback:function(t){e.$set(e.info,"addressReceiver",t)},expression:"info.addressReceiver"}})],1)],1)]):e._e(),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"收货人"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.nameReceiver,callback:function(t){e.$set(e.info,"nameReceiver",t)},expression:"info.nameReceiver"}})],1)],1),e._v(" "),a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"电话"}},[a("el-input",{attrs:{type:"text",disabled:""},model:{value:e.info.mobileReceiver,callback:function(t){e.$set(e.info,"mobileReceiver",t)},expression:"info.mobileReceiver"}})],1)],1)]):e._e(),e._v(" "),1===e.addType?a("el-form-item",{attrs:{label:"SN",required:""}},[a("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.addForm.sns,callback:function(t){e.$set(e.addForm,"sns",t)},expression:"addForm.sns"}})],1):e._e(),e._v(" "),1===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"批量导入SN"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:e.uploadSNUrl,"on-success":e.snUploadSuccess,"on-error":e.snUploadError,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"before-remove":e.beforeRemove,multiple:"",limit:1,"on-exceed":e.handleExceed,"file-list":e.fileList}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1)]):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",disabled:3===e.addType},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1),e._v(" "),1!==e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"创建人"}},[a("el-input",{attrs:{disabled:""},model:{value:e.addForm.nameCreator,callback:function(t){e.$set(e.addForm,"nameCreator",t)},expression:"addForm.nameCreator"}})],1)],1),e._v(" "),a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"创建时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",disabled:""},model:{value:e.addForm.timeCreate,callback:function(t){e.$set(e.addForm,"timeCreate",t)},expression:"addForm.timeCreate"}})],1)],1)]):e._e(),e._v(" "),3===e.addType?a("el-row",[a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"修改人"}},[a("el-input",{attrs:{disabled:""},model:{value:e.addForm.nameUpdater,callback:function(t){e.$set(e.addForm,"nameUpdater",t)},expression:"addForm.nameUpdater"}})],1)],1),e._v(" "),a("div",{staticClass:"el-col el-col-12"},[a("el-form-item",{attrs:{label:"修改时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",disabled:""},model:{value:e.addForm.timeUpdate,callback:function(t){e.$set(e.addForm,"timeUpdate",t)},expression:"addForm.timeUpdate"}})],1)],1)]):e._e(),e._v(" "),a("el-form-item",[3!==e.addType?a("el-button",{attrs:{type:"primary"},on:{click:e.addSubmit}},[e._v(e._s(e.btnName))]):e._e(),e._v(" "),3!==e.addType?a("el-button",{on:{click:e.addCancel}},[e._v("取消")]):e._e(),e._v(" "),3===e.addType?a("el-button",{on:{click:e.addCancel}},[e._v("关闭")]):e._e()],1)],1)],1)],1)},staticRenderFns:[]};var g=a("/Xao")(h,b,!1,function(e){a("op6P")},"data-v-0181a155",null);t.default=g.exports},BNje:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"",""])},op6P:function(e,t,a){var i=a("BNje");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("942edf2e",i,!0)}});